#!/usr/bin/env sh
# -*- coding: utf-8 -*-

# Pilberry runs a car radio based on Raspberry Pi
# Copyright 2014 Olivier Cecillon <ocecillon@users.sourceforge.net>
# and Nicolas Hainaux <nico_h@users.sourceforge.net>

# This file is part of Pilberry.

# Pilberry is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 3 of the License, or
# any later version.

# Pilberry is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.

# You should have received a copy of the GNU General Public License
# along with Pilberry; if not, write to the Free Software
# Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA




# cmus must be configured to execute this script as the way to send feedback
# informations to pilberry (core).

# todo: maybe fix the hard coded port value (should be read from the config file)

# debug
#echo `date "+%T"`": $@" >> /home/pi/pilberry/log/af.log

if [ "$#" -eq 2 ]
then
    # debug
    #echo "2 args, ok" >> /home/pi/pilberry/log/af.log

    if echo "$1 $2" | grep "status stopped" >/dev/null 2>&1
        then
            # debug
            #echo "sending status STOPPED" >> /home/pi/pilberry/log/af.log

            echo "status STOPPED" | nc -w 0 127.0.0.1 31417
        else
            echo "$1 $2" | nc -w 0 127.0.0.1 31417
            echo "$3 $4" | nc -w 0 127.0.0.1 31417
    fi
fi

# So far, we only resend the two first informations (status and full path).
# Below is commented the way to send all informations.

# This script does nothing but send all the command line arguments, gathered as
# pairs in strings, to pilberry_core. An even number of arguments is expected;
#Â if it ever happens to be odd, the last one will be ignored.

#while [ "$#" -gt 1 ]
#  do
#    echo "$1 $2" | nc -w 0 127.0.0.1 31417
#    shift
#    shift
#done
